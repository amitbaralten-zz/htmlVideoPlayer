!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var e;((e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).vtg||(e.vtg={})).tracking=t()}}(function(){return function i(s,r,d){function p(e,t){if(!r[e]){if(!s[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(c)return c(e,!0);var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}var o=r[e]={exports:{}};s[e][0].call(o.exports,function(t){return p(s[e][1][t]||t)},o,o.exports,i,s,r,d)}return r[e].exports}for(var c="function"==typeof require&&require,t=0;t<d.length;t++)p(d[t]);return p}({1:[function(t,e,n){"use strict";var a,o=this&&this.__extends||(a=function(t,e){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__decorate||function(t,e,n,a){var o,i=arguments.length,s=i<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,n):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,a);else for(var r=t.length-1;0<=r;r--)(o=t[r])&&(s=(i<3?o(s):3<i?o(e,n,s):o(e,n))||s);return 3<i&&s&&Object.defineProperty(e,n,s),s},s=this&&this.__awaiter||function(t,s,r,d){return new(r=r||Promise)(function(n,e){function a(t){try{i(d.next(t))}catch(t){e(t)}}function o(t){try{i(d.throw(t))}catch(t){e(t)}}function i(t){var e;t.done?n(t.value):((e=t.value)instanceof r?e:new r(function(t){t(e)})).then(a,o)}i((d=d.apply(t,s||[])).next())})},p=this&&this.__generator||function(n,a){var o,i,s,t,r={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(o)throw new TypeError("Generator is already executing.");for(;r;)try{if(o=1,i&&(s=2&e[0]?i.return:e[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,e[1])).done)return s;switch(i=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return r.label++,{value:e[1],done:!1};case 5:r.label++,i=e[1],e=[0];continue;case 7:e=r.ops.pop(),r.trys.pop();continue;default:if(!(s=0<(s=r.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){r=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){r.label=e[1];break}if(6===e[0]&&r.label<s[1]){r.label=s[1],s=e;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(e);break}s[2]&&r.ops.pop(),r.trys.pop();continue}e=a.call(n,r)}catch(t){e=[6,t],i=0}finally{o=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}};function r(e){return function(t){t.prototype.injectable=e}}Object.defineProperty(n,"__esModule",{value:!0}),n.Injectable=r;var d=(c.prototype.register=function(t){"object"==typeof t&&(this.observers.unshift(t),t.onRegister())},c.prototype.remove=function(e){this.observers=this.observers.filter(function(t){return t!==e})},c.prototype.notify=function(t){for(var e=this.observers.length;e--;){var n=this.observers[e];n.onUpdate.call(n,t)}},c);function c(){this.observers=[]}n.Observable=d;var u=(Object.defineProperty(h,"modules",{get:function(){return[tt,ct,gt,kt,Ct,Lt]},enumerable:!0,configurable:!0}),h.isDev=function(){return!("dev"!==C.get("ut.env"))},h.version="v0.4.0 2/27/2020",h.platform="Sandbox",h.ssl=!0,h.tracker={},h);function h(){}n.SystemInfo=u;var f=(l.isWindow=function(){return"object"==typeof window},l.isTop=function(){return"object"==typeof top},l.isVar=function(t,e){var n=t.split(".");return 2===n.length?l.isWindow()&&typeof window[n[0]]===e&&typeof window[n[0]][n[1]]===e:l.isWindow()&&typeof window[t]===e},l.getVar=function(t){return l.isWindow()&&window[t]},l.getScreenSize=function(){var t=window;return l.isWindow()&&t.screen&&t.screen.width&&t.screen.height?t.screen.width+"x"+t.screen.height:"N/A"},l.isHttps=function(){return l.isTop()&&-1<top.location.href.search(/^https/)},l.getProtocol=function(){return!l.isTop()||l.isHttps()?"https://":"http://"},l.stringify=function(t){return l.isWindow&&l.getVar("JSON")?window.JSON.stringify(t):t.toString()},l);function l(){}n.View=f;var y=(g.POST=function(t){var e=new XMLHttpRequest,n=g.makeUrl(t.ssl,t.url);e.open("POST",n,!0),e.setRequestHeader("Content-Type",t.type||"application/json"),e.onreadystatechange=function(){e.readyState===XMLHttpRequest.DONE&&t.callback({xhr:e,status:e.status,text:200<=e.status&&e.status<300||304===e.status?e.responseText:e.statusText})},e.onerror=function(){t.callback({xhr:e,status:-1,text:"Error "+e.status})},e.send(t.data)},g.GET=function(t){var e=new XMLHttpRequest,n=g.makeUrl(t.ssl,-1===t.url.indexOf("?")?t.url+"?"+t.data:t.url);e.open("GET",n,!0),e.onload=function(){t.callback({xhr:e,status:e.status,text:e.responseText})},e.send()},g.makeUrl=function(t,e){return(t?"https:":"http:")+"//"+e},g);function g(){}n.HttpRequest=y;var v=(m.setLogger=function(t){"object"==typeof t&&"function"==typeof t.log&&(m.logger=t)},m.logger=console||null,m);function m(){}n.Log=v;var S=(I.prototype.add=function(t){this.items.unshift(t)},I.prototype.each=function(t){if(!this.isRunning){this.isRunning=!0;for(var e=this.items.length;e--;){var n=this.items.pop();n&&t(n)}this.isRunning=!1}},I.prototype.isEmpty=function(){return 0===this.items.length},I);function I(){this.items=[],this.isRunning=!1}n.Queue=S;var b=(k.trim=function(t){return t.replace(/^\s+|\s$/g,"")},k.isDefined=function(t){return!(void 0===t||"undefined"===t||""===t)},k);function k(){}n.StringUtil=b;var D=(E.prototype.start=function(t){setInterval&&(this.isRunning||(this.intervalId=setInterval(t,this.milliseconds),this.isRunning=!0))},E.prototype.stop=function(){clearInterval&&(clearInterval(this.intervalId),this.isRunning=!1)},E);function E(t){this.milliseconds=t,this.isRunning=!1}function w(n){return function(t,e){t.keys||(t.keys={}),t.keys[e]=function(t){return t.hasOwnProperty(e)&&t[e]?t[e]:"boolean"!=typeof n?n||"":n}}}n.Timer=D,n.ConfigParam=w;var T=(P.prototype.format=function(){var e=this,n=this,a=this.agent.config.params;return Object.keys(this.keys).forEach(function(t){n[t]=e.keys[t](a)}),n},P.prototype.mapData=function(t){var e=new B([L.ReplaceTokens,L.Ternary,L.OrCondition,L.DataType]),n=this.agent.getData();return e.addSource("data",n),e.addSource("context",n.contextData||{}),e.addSource("config",this.agent.config.params),e.setMap(t),e.setType(this.dataType),e.getData()},P);function P(t){this.agent=t,this.dataType={},this.format()}n.DataAccess=T;var C=(A.get=function(t){var e=window;return e.utag&&e.utag.data?e.utag.data[t]:""},A);function A(){}n.DataLayer=C;var M=(R.prototype.update=function(t){this.data=this.merge(t),this.data.timestamp=(new Date).getTime(),this.data.utcSeconds=Math.round((new Date).getTime()/1e3)},R.prototype.getData=function(){return this.data},R.prototype.merge=function(n){var a=this.data;return Object.keys(n).forEach(function(t){var e=n[t];null!=e&&(a[t]=e)}),a},R);function R(){this.data={}}n.DataProxy=M;var O=(U.get=function(t){var e=window,n="";return e.localStorage&&(n=e.localStorage.getItem(t)),n||""},U.set=function(t,e){var n=window;n.localStorage&&n.localStorage.setItem(t,e)},U);function U(){}n.DataStorage=O;var L=(x.ReplaceTokens=function(o){var i={};return Object.keys(o.map).forEach(function(a){var t=o.map[a],e=t?t.toString().match(/\{\w+.\w+\}/g):null;i[a]=o.map[a],e&&e.forEach(function(t){var e=t.replace(/\{|\}/g,"").split("."),n=o.source[e[0]][e[1]];i[a]=i[a].replace(t.toString(),n)})}),i},x.Ternary=function(o){var i={};return Object.keys(o.data).forEach(function(t){var e=o.data[t].toString().match(/(.+)\?(.+):(.+)/);if(e&&3<e.length){var n=b.trim(e[1]),a=!1;"true"!==n&&"undefined"===n||(a=!0),"false"!==n&&""!==n||(a=!1),i[t]=a?e[2]:e[3],i[t]=b.trim(i[t])}else i[t]=o.data[t]}),i},x.OrCondition=function(i){var s={};return Object.keys(i.data).forEach(function(t){var e=i.data[t].toString(),n=e.match(/(.+)\|\|(.+)/);if(s[t]=e,n&&2<n.length){var a=b.trim(n[1]||""),o=b.trim(n[2]||"");b.isDefined(a)?s[t]=a:b.isDefined(o)&&(s[t]=o)}}),s},x.DataType=function(n){var a={};return Object.keys(n.data).forEach(function(t){var e=n.data[t].toString();if(e)switch(n.types[t]){case"int":a[t]=parseInt(e);break;case"boolean":a[t]="true"===e;break;default:a[t]=e}}),a},x);function x(){}n.Rules=L;var B=(j.prototype.addSource=function(t,e){this.source[t]=e},j.prototype.setMap=function(t){this.map=t},j.prototype.setType=function(t){this.types=t},j.prototype.getData=function(){for(var t={},e=0,n=this.rules;e<n.length;e++)t=(0,n[e])({source:this.source,map:this.map,data:t,types:this.types});return t},j);function j(t){this.rules=[],this.source={},this.map={},this.types={},this.rules=t}n.RulesEngine=B;var _=(N.prototype.onRegister=function(){},N.prototype.onUpdate=function(t){var e=this;this.notifications.add(t),this.hasSdkLoaded()&&this.notifications.each(function(t){e.onNotify(t)})},N.prototype.hasSdkLoaded=function(){if("object"!=typeof this.injectable)return this.isSdkLoaded;var t=this.injectable,e=f.getVar(t.name);return e&&(this[t.name]=e,this.isSdkLoaded=!0),this.isSdkLoaded},N.prototype.onNotify=function(t){var e={isAd:!1,adBreakType:"preroll"};switch((this.notification=t).name){case"adBreakStart":case"adStart":e.isAd=!0;var n=t.body;n&&n.adBreakType&&(e.adBreakType=n.adBreakType.toLowerCase()+"roll");break;case"adEnd":case"adBreakEnd":case"contentStart":e.isAd=!1}this.observable.dataProxy.update(e);var a=this.events[t.name];a&&a.call(this)},N.prototype.getData=function(){return this.observable.dataProxy.getData()},N.prototype.hasContentCompleted=function(){var t=this.getData();return(!t||!t.isLive)&&t.playhead>=.95*t.duration},N);function N(t,e){this.config=t,this.observable=e,this.events={},this.notifications=new S,this.isSdkLoaded=!1,this.isDev=!1,this.isDev=e.isDev}function H(){return function(t,e){t.observer=!0}}n.Agent=_,n.Subscribe=H;var q=(z.prototype.startUp=function(a){var o=this;nt.request(a).then(function(t){var e=new B([L.ReplaceTokens]),n=a.params.serverInfo;e.addSource("config",{reportSuite:u.isDev()?n.devSuite:n.prodSuite,mid:t.d_mid}),e.setMap(a.params.appTrackingInfo),o.info=e.getData(),o.api=new rt(o.info.dataUrl),o.isReady=!0,delete o.info.dataUrl,o.flush()})},z.prototype.track=function(t){this.queue.add(t),this.isReady&&this.flush()},z.prototype.flush=function(){var e=this;this.queue.each(function(t){e.post(t)})},z.prototype.post=function(t){for(var e in this.info)t[e]||(t[e]=this.info[e]);this.api&&this.api.post(t)},z);function z(t){this.config=t,this.queue=new S,this.isReady=!1,this.info={};var e=t.Adobe;e&&e.enabled&&this.startUp(e)}n.AppTracker=q;var V=(F.prototype.onRegister=function(){},F.prototype.onUpdate=function(t){switch(t.name){case"contentStart":this.hasSessionEnd=!1,this.hasContentStart=!0;break;case"adBreakStart":this.isAd=!0,this.timer.stop();break;case"adBreakEnd":this.isAd=!1,this.isStopped=!0;break;case"contentPause":case"bufferStart":case"seekStart":this.isStopped=!0,this.startHb();break;case"timeUpdate":this.timeUpdate();break;case"contentEnd":case"sessionEnd":this.hasSessionEnd=!0,this.hasContentStart=!1,this.isStopped=!0,this.timer.stop()}},F.prototype.timeUpdate=function(){this.hasSessionEnd||this.isStopped&&this.hasContentStart&&!this.isAd&&(this.isStopped=!1,this.startHb())},F.prototype.startHb=function(){var t=this;this.timer.stop(),this.timer.start(function(){t.tracker.track("hb")})},F.NAME="Hb",F);function F(t){this.tracker=t,this.hasContentStart=!1,this.hasSessionEnd=!1,this.isStopped=!0,this.isAd=!1,this.config={name:"Hb",enabled:!0,params:{}},this.timer=new D(1e4)}n.Heartbeat=V;var K=(Q.prototype.register=function(a){var o=this;this.tracker=a,this.registerAgent(new V(a)),this.tracker.modules.forEach(function(t){var e=t;if(o.isAgentEnabled(e.NAME)){var n=o.getAgentConfig(e.NAME);o.registerAgent(new e(n,a))}})},Q.prototype.isAgentEnabled=function(t){return this.tracker.config.hasOwnProperty(t)&&this.tracker.config[t].hasOwnProperty("enabled")&&this.tracker.config[t].enabled},Q.prototype.getAgentConfig=function(t){var e=this.tracker.config[t];return e.params||(e.params={}),e.name||(e.name=t),e.params.debug=u.isDev(),e},Q.prototype.registerAgent=function(e){this.tracker.observers.find(function(t){return t.config.name===e.config.name})||this.tracker.register(e)},Q);function Q(){}n.Registrar=K;var W,G=(o(X,W=d),X.prototype.track=function(t,e){if("sessionStart"===t&&(this.dataProxy=new M),e=e||{},"timeUpdate"===t){if(!this.hasProgress(e.playhead))return;e.playhead=this.playhead}e.playhead=e.playhead?Math.floor(e.playhead):this.playhead,this.playhead=e.playhead,this.dataProxy.update(e),this.isDev&&v.logger.log(this.logId,t,e),this.notify({name:t})},X.prototype.hasProgress=function(t){var e=Math.floor(t);return!isNaN(e)&&this.playhead!==e&&(this.playhead=e,!0)},X.prototype.setConfig=function(t){this.isDev=u.isDev(),this.isDev&&v.logger.log(this.logId,"setConfig",t),this.config||"object"==typeof t&&(this.config=t,this.registrar.register(this))},X);function X(){var t=null!==W&&W.apply(this,arguments)||this;return t.modules=u.modules,t.dataProxy=new M,t.registrar=new K,t.playhead=0,t.isDev=!1,t.logId="[Tracker]",t}n.VideoTracker=G;var J,$=(o(Y,J=G),Y.prototype.onRegister=function(t,e,n){var a=this;e.config&&this.setConfig(e.config);var o=t.EventType;for(var i in this.notifyHandler=function(t){return a.onNotify(t)},o)t.on(o[i],this.notifyHandler);(u.tracker[t.id]=this).player=t,this.service=n},Y.prototype.onNotify=function(t){this.model=this.player.getModelSnapshot(),this.event=t,this.isDev&&v.logger.log(this.logId+" => "+t.type);var e=this.eventMap[t.type];e&&e.call(this,t)},Y.prototype.sessionStart=function(){if(!this.hasSessionStart){var t=this.service.buildInfo.buildInfo,e=this.player.playlist.currentItem,n=e.contentMetadata,a=e.resourceLocation,o=this.service.system,i=Object.assign(this.getContentInfo(),{sessionId:C.get("ut.session_id")||"",playerName:t.playerName,playerVersion:t.playerVersion,playerId:this.player.id,userId:this.service.playerOptions.userId||"",userCountry:"us",partner:e.adSettings.tracking.partner||"",drmEnabled:a&&a.drm.enabled,drmType:this.model.ContentPlaybackState.drmType||"none",isMobile:!!o.isMobile,isPaidContent:n&&n.isPaidContent||!1,isAffiliateFeed:n&&n.isAffiliateFeed||!1,isDai:!!(e.adSettings&&e.adSettings.context&&-1<e.adSettings.context.indexOf("dai")),systemDevice:o&&o.device?o.device:"",videoElement:this.service.playerDomProxy.data.video,screenSize:f.getScreenSize()});this.send("sessionStart",i),this.hasSessionStart=!0}},Y.prototype.sessionEnd=function(){this.send("sessionEnd"),this.hasSessionStart=!1,this.hasContentStart=!1},Y.prototype.send=function(t,e){var n=e||{};n.hasOwnProperty("playhead")||(n.playhead=this.model.ContentPlaybackState.playheadTime),this.isAd&&(n.playhead=this.adPlayhead),J.prototype.track.call(this,t,n)},Y.prototype.isLive=function(){var t=this.player.playlist.currentItem.contentMetadata.streamType;return!(!t||"LIVE"!==t.toLocaleUpperCase())},Y.prototype.getContentInfo=function(){var t=this.model.ContentPlaybackState,e=this.player.playlist.currentItem,n=e.contentMetadata,a=e.resourceLocation;return{timeToStart:Math.abs((new Date).getTime()-this.startTime),mediaUrl:a.mediaUrl||"",mediaId:n.videoIdForTracking||"",duration:t.duration||-1,playhead:t.playheadTime||0,bitrate:this.toKbps(t.playbackBitrate),cdn:t.cdn,contextData:e.contextMetadata,videoTitle:n.videoTitle||"",seriesTitle:n.seriesTitle||"",seasonNumber:n.seasonNumber||"",episodeNumber:n.episodeNumber||"",category:n.category||"",isLive:this.isLive(),isEpisode:n.episodeFlag,episodeTitle:n.episodeTitle||"",hasSessionResumed:0<t.playheadTime,streamId:this.model.PresentationState.streamId||""}},Y.prototype.toKbps=function(t){return Math.floor(t/1e3)},Y.prototype.destroy=function(){var t=this.player.EventType;for(var e in t)this.player.off(t[e],this.notifyHandler);this.sessionEnd(),this.player=null,this.service=null,this.model=null,this.event=null},Y);function Y(){var o=null!==J&&J.apply(this,arguments)||this;return o.hasSessionStart=!1,o.hasContentStart=!1,o.hasAdBreakEnded=!1,o.hasBufferStart=!1,o.isSeeking=!1,o.isStopped=!1,o.adPlayhead=0,o.startTime=0,o.isAd=!1,o.eventMap={adBreakMetadata:function(){o.sessionStart();var t=o.model.AdBreakInfo,e=o.getContentInfo();e.adBreakType=t.adBreakType,e.adBreakPosition=t.adBreakPosition,e.adBreakDuration=t.adBreakDuration,o.isAd=!0,o.send("adBreakStart",e)},adStart:function(){var t=o.model.AdItem;o.adPlayhead=0,o.send("adStart",{adId:t.adId||"",adTitle:t.adTitle||"",adUrl:t.adAssetUrl||"",adPosition:t.adPosition,adDuration:t.adDuration})},adPaused:function(){o.send("adPause")},adPlaying:function(){o.send("adResume")},adProgress:function(){o.adPlayhead=o.event.data.currentTime},adSkip:function(){o.send("adSkip"),o.isAd=!1},adError:function(){o.isAd=!1},adComplete:function(){o.send("adEnd")},adBreakComplete:function(){o.send("adBreakEnd"),o.hasAdBreakEnded=!0,o.isAd=!1,o.adPlayhead=0},cdnChanged:function(){var t=o.model.ContentPlaybackState;o.hasContentStart&&o.send("cdnChange",{cdn:t.cdn||""})},contentBitrateChanged:function(){var t=o.model.ContentPlaybackState;o.send("bitrateChange",{bitrate:o.toKbps(t.playbackBitrate)})},contentStart:function(){o.sessionStart(),o.send("contentStart",o.getContentInfo()),o.hasContentStart=!0},contentProgress:function(){if(!o.isSeeking&&!o.isAd&&o.hasContentStart){o.hasBufferStart&&(o.hasBufferStart=!1,o.send("bufferEnd"));var t={playhead:o.model.ContentPlaybackState.playheadTime};o.isStopped&&(o.isStopped=!1,o.send("contentResume",t)),o.hasAdBreakEnded&&(o.hasAdBreakEnded=!1,o.send("contentResume",t)),o.send("timeUpdate",t)}},hb:function(){o.isAd||o.send("hb")},contentPaused:function(){o.send("contentPause"),o.isStopped=!0},contentSeeking:function(){o.isSeeking=!0,o.send("seekStart")},contentSeeked:function(){o.isSeeking=!1,o.send("seekEnd")},contentBuffering:function(){o.hasBufferStart=!0,o.send("bufferStart")},contentComplete:function(){o.hasContentStart&&o.send("contentEnd")},drmKeySystemCreated:function(){o.send("drmCreated",{drmType:o.model.ContentPlaybackState.drmType})},resourceStart:function(){o.startTime=(new Date).getTime(),o.sessionStart()},resourceEnd:o.sessionEnd,resourceInterrupted:o.sessionEnd,resourceError:function(t){"object"==typeof t&&J.prototype.track.call(o,"playerError",{errorType:t.status||NaN,errorMessage:t.message||"",errorFatal:t.isFatal||!1})},metadataCuepoint:function(t){if(t&&t.data){var e=t.data;if(e.data&&"string"==typeof e.data&&-1<e.data.indexOf("|")){var n=e.data.split("|"),a=b.trim;1<n.length&&J.prototype.track.call(o,"cuePoint",{segmentId:a(n[0]),segmentTitle:a(n[1]),segmentEdition:a(n[2]),segmentOwner:e.id})}}}},o}n.CvpTracker=$;var Z,tt=(o(et,Z=_),et.prototype.onRegister=function(){Z.prototype.onRegister.call(this),this.dao=new it(this),this.eventQueue=new S},et.prototype.flushQueue=function(){var e=this;this.hasSession&&this.eventQueue.each(function(t){e.postRequest(t)})},et.prototype.postRequest=function(t){"play"===t&&this.getData().isAd||y.POST({url:this.eventUrl,ssl:this.dao.enableSSL,data:f.stringify(this.dao.getPayload(t)),callback:Function.prototype})},et.prototype.startSession=function(){var n=this;this.hasSessionRequest||(y.POST({url:this.dao.getSessionUrl(),ssl:this.dao.enableSSL,data:f.stringify(this.dao.getSessionInfo()),callback:function(t){if(400===t.status)throw"Error: Server 400";var e=t.xhr.getResponseHeader("location");if(!e)throw"Error: Location not found";n.hasSession=!0,n.eventUrl=n.dao.getEventUrl(e),n.flushQueue()}}),this.hasSessionRequest=!0)},et.prototype.trackEvent=function(t){this.eventQueue.add(t),this.flushQueue()},et.prototype.contentStart=function(){this.startSession(),this.trackEvent("play")},et.prototype.play=function(){this.hasStateChange&&(this.hasStateChange=!1,this.trackEvent("play"))},et.prototype.ping=function(){this.trackEvent("ping")},et.prototype.sessionEnd=function(){this.hasSession&&(this.hasContentCompleted()&&this.trackEvent("sessionComplete"),this.trackEvent("sessionEnd"),this.hasSession=!1),this.hasSessionRequest=!1},et.NAME="Adobe",i([H()],et.prototype,"events",void 0),et);function et(){var e=null!==Z&&Z.apply(this,arguments)||this;return e.hasSession=!1,e.hasSessionRequest=!1,e.hasStateChange=!1,e.isSdkLoaded=!0,e.hasNewSegment=!1,e.events={adBreakStart:function(){e.startSession(),e.trackEvent("adBreakStart")},adStart:function(){e.trackEvent("adStart")},adPause:function(){e.trackEvent("pauseStart"),e.hasStateChange=!0},adSkip:function(){e.trackEvent("adSkip")},adEnd:function(){e.trackEvent("adComplete")},adBreakEnd:function(){e.trackEvent("adBreakComplete"),e.hasStateChange=!0},contentPause:function(){e.hasStateChange=!0,e.trackEvent("pauseStart")},bufferStart:function(){e.hasStateChange=!0,e.trackEvent("bufferStart")},seekStart:function(){e.hasStateChange=!0},cuePoint:function(){if(e.getData().isLive||e.dao.isOwner()){var t=e.getData().segmentId;e.liveSegmentId!==t&&e.dao.liveSegmentInfo?(e.liveSegmentId=t,e.hasNewSegment=!0,e.sessionEnd(),e.contentStart()):e.hasNewSegment=!1}},playerError:function(){e.trackEvent("error"),e.sessionEnd()},contentStart:e.contentStart,contentResume:e.play,adResume:e.play,timeUpdate:e.play,hb:e.ping,sessionEnd:e.sessionEnd},e}n.AdobeAgent=tt;var nt=(at.request=function(d){return s(this,void 0,void 0,function(){var e,n,a,o,i,s,r;return p(this,function(t){return e=d.params.accountInfo["visitor.marketingCloudOrgId"],n=d.params.serverInfo.demdexUrl+e,a=u.ssl,o="d_mid",i=function(t){y.GET({url:n,data:null,ssl:a,callback:t})},(s=f.getVar("Visitor"))?(r=s.getInstance(e),[2,new Promise(function(t,e){var n=r.getMarketingCloudVisitorID();n?(O.set(o,n),t({d_mid:n})):e(new Error("visitor not found"))})]):O.get(o)?[2,new Promise(function(t,e){t({d_mid:O.get(o)})})]:[2,new Promise(function(n,a){i(function(t){if(-1===t.status)a(new Error(t.text));else{var e=JSON.parse(t.text)[o];e?(O.set(o,e),n({d_mid:e})):a(new Error("d_mid not found"))}})})]})})},at.getMid=function(){var t=O.get("d_mid");return t||""},at);function at(){}n.AdobeCloudId=nt;var ot,it=(o(st,ot=T),st.prototype.getSessionInfo=function(){var t=this.getPayload("sessionStart");if(this.agent.config.params.reportSuite=this.agent.isDev?this.serverInfo.devSuite:this.serverInfo.prodSuite,t.params=Object.assign(this.mapData(this.mediaInfo),this.mapData(this.accountInfo)),t.customMetadata=this.mapData(Object.assign(this.agent.getData().contextData||{},this.customData)),t.qoeData=this.mapData(this.qoeData),this.agent.hasNewSegment){var e=this.mapData(this.liveSegmentInfo);t.params=Object.assign(t.params,e)}return t},st.prototype.getAdBreakInfo=function(){return this.mapData(this.adBreakInfo)},st.prototype.getAdInfo=function(){return this.mapData(this.adInfo)},st.prototype.getSessionUrl=function(){return[this.agent.isDev?this.serverInfo.devUrl:this.serverInfo.prodUrl,st.SESSION_PATH].join("/")},st.prototype.getEventUrl=function(t){return[this.agent.isDev?this.serverInfo.devUrl:this.serverInfo.prodUrl,t.replace(/^\/|\/$/g,""),"events"].join("/")},st.prototype.getPayload=function(t){var e=this.agent.getData(),n={};switch(t){case"adBreakStart":n=this.getAdBreakInfo();break;case"adStart":n=this.getAdInfo()}return{eventType:t,playerTime:{playhead:e.playhead,ts:(new Date).getTime()},params:n}},st.prototype.isOwner=function(){return this.agent.getData().segmentOwner===this.serverInfo.id3Owner},st.SESSION_PATH="api/v1/sessions",i([w(!0)],st.prototype,"enableSSL",void 0),i([w()],st.prototype,"serverInfo",void 0),i([w()],st.prototype,"accountInfo",void 0),i([w()],st.prototype,"mediaInfo",void 0),i([w()],st.prototype,"adBreakInfo",void 0),i([w()],st.prototype,"adInfo",void 0),i([w()],st.prototype,"customData",void 0),i([w()],st.prototype,"qoeData",void 0),i([w()],st.prototype,"dataType",void 0),i([w()],st.prototype,"liveSegmentInfo",void 0),st);function st(t){var e=ot.call(this,t)||this;return e.agent=t,e.enableSSL="true"===e.accountInfo["analytics.enableSSL"],e.serverInfo.demdexUrl&&nt.request(t.config).then(function(t){e.agent.config.params.mid=t.d_mid}),e}n.AdobeDao=it;var rt=(dt.prototype.post=function(e){return s(this,void 0,void 0,function(){var a,o;return p(this,function(t){return a=this.request.bind(this),o=this.format(e),[2,new Promise(function(e,n){a(o,function(t){-1===t.status?n(new Error(t.text)):e(t)})})]})})},dt.prototype.request=function(t,e){y.POST({url:this.url,data:t,ssl:u.ssl,callback:e})},dt.prototype.format=function(t){return['<?xml version="1.0" encoding="UTF-8"?>',"<request>",this.toXml(t),"</request>"].join("")},dt.prototype.toXml=function(e){var n=this,a="";return Object.keys(e).forEach(function(t){a+="<{key}>{value}</{key}>".replace(/{key}/g,t).replace(/{value}/g,"object"!=typeof e[t]?n.htmlEntities(e[t]):n.toXml(e[t]))}),a},dt.prototype.htmlEntities=function(t){if(!t)return t;function n(t){return["&",t,";"].join("")}return t.toString().replace(/&|"|'|<|>/g,function(t){var e=t.toString();switch(e){case"&":e=n("amp");break;case'"':e=n("quot");break;case"'":e=n("apos");break;case"<":e=n("lt");break;case">":e=n("gt")}return e})},dt);function dt(t){this.url=t}n.AdobeData=rt;var pt,ct=(o(ut,pt=_),ut.prototype.onRegister=function(){pt.prototype.onRegister.call(this),this.dao=new ft(this)},ut.NAME="Sparrow",i([H()],ut.prototype,"events",void 0),ut);function ut(){var t=null!==pt&&pt.apply(this,arguments)||this;return t.isSdkLoaded=!0,t.events={timeUpdate:function(){t.dao.hasElapsed()&&y.GET({url:t.dao.getApiUrl(),ssl:u.ssl,data:t.dao.getInfo(),callback:Function.prototype})}},t}n.SparrowAgent=ct;var ht,ft=(o(lt,ht=T),lt.prototype.getApiUrl=function(){return[this.agent.isDev?this.serverInfo.devUrl:this.serverInfo.prodUrl,this.serverInfo.urlPath].join("/")},lt.prototype.getInfo=function(){var t=this.agent.getData();t.platform=this.getPlatform(),t.timestamp=Math.floor(t.timestamp/1e3);var e=this.mapData(this.metadataInfo),n=[];for(var a in e)n.push(a+"="+e[a]);return n.join("&")},lt.prototype.getPlatform=function(){var t=this.agent.getData(),e=u.platform;return"Desktop"===e&&t.isMobile&&(e="mobile_web"),e},lt.prototype.hasElapsed=function(){var t=this.agent.getData();return t.playhead%this.serverInfo.interval==0&&(t.isEpisode||t.isLive)},i([w()],lt.prototype,"serverInfo",void 0),i([w()],lt.prototype,"metadataInfo",void 0),lt);function lt(t){var e=ht.call(this,t)||this;return e.agent=t,e}n.SparrowDao=ft;var yt,gt=(o(vt,yt=_),vt.prototype.onRegister=function(){yt.prototype.onRegister.call(this),this.dao=new St(this)},vt.prototype.sessionStart=function(){this.tag=new this.ns_.ReducedRequirementsStreamingAnalytics(this.dao.getConfig())},vt.prototype.adPlay=function(){this.tag&&this.tag.playVideoAdvertisement(this.dao.getAdInfo(),this.dao.getAdType()),this.isStopped=!1},vt.prototype.contentPlay=function(){this.tag&&this.tag.playVideoContentPart(this.dao.getContentInfo(),this.dao.getContentType()),this.isStopped=!1},vt.prototype.stop=function(){this.isStopped=!0,this.tag&&this.tag.stop()},vt.NAME="Comscore",i([H()],vt.prototype,"events",void 0),vt=i([r({name:"ns_",type:"object"})],vt));function vt(){var t=null!==yt&&yt.apply(this,arguments)||this;return t.hasContentStart=!1,t.isStopped=!1,t.events={sessionStart:t.sessionStart,adStart:t.adPlay,adEnd:t.stop,contentStart:t.contentPlay,contentResume:t.contentPlay,resourceInterrupted:t.stop,contentEnd:t.stop,contentPause:t.stop,seekStart:t.stop,sessionEnd:t.stop,id3Data:function(){t.stop(),t.contentPlay()},timeUpdate:function(){t.hasContentStart&&t.isStopped&&(t.contentPlay(),t.isStopped=!1)}},t}n.ComscoreAgent=gt;var mt,St=(o(It,mt=T),It.prototype.getConfig=function(){return{publisherId:this.publisherId,ns_st_pu:this.agent.getData().partner}},It.prototype.getAdInfo=function(){return{ns_st_cl:this.agent.getData().adDuration}},It.prototype.getAdType=function(){var t=this.agent.getData(),e=this.agent.ns_.ReducedRequirementsStreamingAnalytics.AdType,n=t.adId.split("_")[0];return t.isLive?e.LinearLive:"pre"===n?e.LinearOnDemandPreRoll:"mid"===n?e.LinearOnDemandMidRoll:e.LinearOnDemandPostRoll},It.prototype.getContentInfo=function(){var t=this.mapData(this.contentInfo);return t.c2||(t.c2=this.publisherId),t},It.prototype.getContentType=function(){var t=this.agent.ns_.ReducedRequirementsStreamingAnalytics.ContentType,e=this.agent.getData(),n=e.isLive?t.Live:t.LongFormOnDemand;return e.duration<600&&(n=t.ShortFormOnDemand),n},i([w()],It.prototype,"publisherId",void 0),i([w()],It.prototype,"contentInfo",void 0),It);function It(t){var e=mt.call(this,t)||this;return e.agent=t,e}n.ComscoreDao=St;var bt,kt=(o(Dt,bt=_),Dt.prototype.onRegister=function(){bt.prototype.onRegister.call(this),this.dao=new wt(this)},Dt.prototype.createSession=function(){if(!(-1<this.sessionId)){var t=this.Conviva,e=new t.SystemSettings,n=new t.SystemInterface(new t.Impl.Html5Time,new t.Impl.Html5Timer,new t.Impl.Html5Http,new t.Impl.Html5Storage,this.dao.getHtml5Metadata(),new t.Impl.Html5Logging),a=new t.SystemFactory(n,e),o=new t.ClientSettings(this.dao.getCustomerKey());o.gatewayUrl=this.dao.getGatewayUrl(),this.client=new t.Client(o,a),this.playerManager=this.client.getPlayerStateManager(),this.sessionId=this.client.createSession(this.dao.getContentInfo()),this.html5Player=new t.Impl.Html5PlayerInterface(this.playerManager,this.getData().videoElement,a),this.attachPlayer()}},Dt.prototype.attachPlayer=function(){this.client&&this.client.attachPlayer(this.sessionId,this.playerManager)},Dt.prototype.cleanUp=function(){-1!==this.sessionId&&(this.html5Player&&this.html5Player.cleanup(),this.client&&(this.client.releasePlayerStateManager(this.playerManager),this.client.cleanupSession(this.sessionId)),this.html5Player=null,this.playerManager=null,this.sessionId=-1)},Dt.prototype.updateInfo=function(){-1!==this.sessionId&&this.client&&this.client.updateContentMetadata(this.sessionId,this.dao.getContentInfo())},Dt.NAME="ConvivaHtml5",i([H()],Dt.prototype,"events",void 0),Dt=i([r({name:"Conviva",type:"function"})],Dt));function Dt(){var a=null!==bt&&bt.apply(this,arguments)||this;return a.sessionId=-1,a.isDai=!1,a.events={sessionStart:function(){a.isDai=a.getData().isDai,a.createSession()},contentStart:a.updateInfo,seekStart:function(){-1!==a.sessionId&&a.playerManager.setPlayerSeekStart(a.getData().playhead)},seekEnd:function(){-1!==a.sessionId&&a.playerManager.setPlayerSeekEnd()},adBreakStart:function(){-1===a.sessionId&&a.createSession()},adStart:function(){if(!a.isDai){var t=a.Conviva.Client,e=a.getData().adBreakType,n=t.AdPosition.PREROLL;"MID"===e?n=t.AdPosition.MIDROLL:"POST"===e&&(n=t.AdPosition.POSTROLL),a.client.adStart(a.sessionId,t.AdStream.SEPARATE,t.AdPlayer.SEPARATE,n),a.client.detachPlayer(a.sessionId)}},adEnd:function(){a.isDai||(a.client.attachPlayer(a.sessionId,a.playerManager),a.client.adEnd(a.sessionId))},cdnChange:function(){a.client&&a.client.updateContentMetadata(a.sessionId,a.dao.getCdnInfo())},drmCreated:a.updateInfo,bitrateChange:function(){-1===a.sessionId||a.getData().isAd||a.playerManager.setBitrateKbps(a.getData().bitrate)},playerError:function(){var t=a.dao.getErrorInfo();a.createSession(),a.playerManager&&a.playerManager.sendError(t.message,t.severity),a.client&&a.client.reportError(a.sessionId,t.message,t.severity),a.getData().errorFatal&&a.cleanUp()},sessionEnd:a.cleanUp},a}n.ConvivaHtml5Agent=kt;var Et,wt=(o(Tt,Et=T),Tt.prototype.getCustomerKey=function(){return this.isDev?this.serverInfo.devKey:this.serverInfo.prodKey},Tt.prototype.getGatewayUrl=function(){var t=this.isDev?this.serverInfo.devUrl:this.serverInfo.prodUrl;return f.getProtocol()+t},Tt.prototype.getContentInfo=function(){var t=Object.assign(new this.agent.Conviva.ContentMetadata,this.mapData(this.contentInfo));return t.custom=this.mapData(this.customTagInfo),t},Tt.prototype.getCdnInfo=function(){return Object.assign(new this.agent.Conviva.ContentMetadata,this.mapData(this.cdnInfo))},Tt.prototype.getErrorInfo=function(){var t=this.agent.getData();return{message:t.errorMessage,severity:t.errorFatal?0:1}},Tt.prototype.getHtml5Metadata=function(){var e=new this.agent.Conviva.Impl.Html5Metadata,n=this.mapData(this.metadataInfo);return Object.keys(n).forEach(function(t){e[t]=function(){return n[t]}}),e},i([w()],Tt.prototype,"serverInfo",void 0),i([w()],Tt.prototype,"contentInfo",void 0),i([w()],Tt.prototype,"adBreakInfo",void 0),i([w()],Tt.prototype,"adInfo",void 0),i([w()],Tt.prototype,"cdnInfo",void 0),i([w()],Tt.prototype,"customTagInfo",void 0),i([w()],Tt.prototype,"metadataInfo",void 0),i([w()],Tt.prototype,"dataType",void 0),Tt);function Tt(t){var e=Et.call(this,t)||this;return e.agent=t,e.isDev=!1,e.isDev=e.agent.isDev,e}n.ConvivaHtml5Dao=wt;var Pt,Ct=(o(At,Pt=_),At.prototype.onRegister=function(){Pt.prototype.onRegister.call(this),this.dao=new Rt(this)},At.prototype.startSession=function(){var t=this.dao.getServerInfo(),e=f.getVar("NOLBUNDLE");"function"==typeof e.nlsQ&&(!u.isDev()&&t.nol_sdkDebug&&delete t.nol_sdkDebug,this.sdk=e.nlsQ(t.appId,"nolInstance",t))},At.prototype.loadMetadata=function(){if(this.sdk){var t=this.getData().isAd?this.dao.getAdInfo():this.dao.getMediaInfo();this.sdk.ggPM("loadMetadata",t)}},At.prototype.trackEvent=function(t){this.sdk&&this.sdk.ggPM(t,this.dao.getPlayhead())},At.NAME="NielsenDCR",i([H()],At.prototype,"events",void 0),At=i([r({name:"NOLBUNDLE",type:"object"})],At));function At(){var t=null!==Pt&&Pt.apply(this,arguments)||this;return t.events={adStart:t.loadMetadata,adEnd:function(){t.trackEvent("stop")},contentStart:t.loadMetadata,contentEnd:function(){t.trackEvent("stop")},sessionStart:t.startSession,sessionEnd:function(){t.trackEvent("end")},timeUpdate:function(){t.trackEvent("setPlayheadPosition")},playerError:function(){t.trackEvent("end")}},t}n.NielsenDCRAgent=Ct;var Mt,Rt=(o(Ot,Mt=T),Ot.prototype.getServerInfo=function(){return this.mapData(this.serverInfo)},Ot.prototype.getAdInfo=function(){return this.mapData(this.adInfo)},Ot.prototype.getMediaInfo=function(){return this.mapData(this.mediaInfo)},Ot.prototype.getPlayhead=function(){var t=this.agent.getData();return t.isLive?t.utcSeconds:t.playhead},i([w()],Ot.prototype,"serverInfo",void 0),i([w()],Ot.prototype,"mediaInfo",void 0),i([w()],Ot.prototype,"adInfo",void 0),Ot);function Ot(t){var e=Mt.call(this,t)||this;return e.agent=t,e}n.NielsenDCRDao=Rt;var Ut,Lt=(o(xt,Ut=_),xt.prototype.onRegister=function(){Ut.prototype.onRegister.call(this),this.dao=new jt(this)},xt.prototype.timeUpdate=function(){this.getData().isAd||(this.hasContentStart&&(this.startSession(),this.begin(),this.hasContentStart=!1),this.isStopped&&(this.isStopped=!1,this.ozTamInstance&&this.ozTamInstance.resumeProgress()))},xt.prototype.startSession=function(){var t=this.dao.getConfigInfo();this.ozTamInstance=new this.OzTAMService(t.publisherId,t.vendorVersion,t.productionMode,t.verboseLogging,t.useHTTPS),this.mediaInfo=this.dao.getMediaInfo(),this.ozTamInstance&&this.ozTamInstance.startSession(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaType)},xt.prototype.begin=function(){this.ozTamInstance&&this.ozTamInstance.beginPlayback(this.mediaInfo.mediaId,this.mediaInfo.url,this.mediaInfo.mediaDuration,this.mediaInfo.mediaPositionFunction,this.dao.getPropertyInfo(),this.mediaInfo.mediaType)},xt.prototype.stop=function(){this.isStopped=!0,this.ozTamInstance&&this.ozTamInstance.haltProgress()},xt.NAME="OzTam",i([H()],xt.prototype,"events",void 0),xt=i([r({name:"OzTAMService",type:"function"})],xt));function xt(){var t=null!==Ut&&Ut.apply(this,arguments)||this;return t.hasContentStart=!1,t.isStopped=!1,t.events={contentStart:function(){t.hasContentStart=!0},seekStart:function(){t.ozTamInstance&&t.ozTamInstance.seekBegin()},seekEnd:function(){t.ozTamInstance&&t.ozTamInstance.seekComplete(),t.isStopped=!0},contentEnd:function(){t.ozTamInstance&&t.ozTamInstance.complete()},contentPause:t.stop,bufferStart:t.stop,contentResume:t.timeUpdate,timeUpdate:t.timeUpdate},t}n.OzTamAgent=Lt;var Bt,jt=(o(_t,Bt=T),_t.prototype.getConfigInfo=function(){return{publisherId:this.agent.getData().isLive?this.serverInfo.liveKey:this.serverInfo.vodKey,vendorVersion:this.getVersion(),productionMode:this.serverInfo.productionMode,verboseLogging:this.agent.isDev,useHTTPS:this.serverInfo.useHTTPS}},_t.prototype.getVersion=function(){var t=this.agent.getData(),e=t.isMobile?"Mobile-Web":"Desktop-Web";return"CAF"===u.platform&&(e="Chromecast"),[this.serverInfo.platform,e,t.playerVersion].join("_")},_t.prototype.getMediaInfo=function(){var t=this.agent.getData(),e=this.mapData(this.mediaInfo),n=function(){return t.playhead}.bind(this);return e.mediaPositionFunction=n,e},_t.prototype.getPropertyInfo=function(){var t=this.agent.getData(),e={};return t.ozTamMediaId&&(e.altMediaId=t.mediaId),t.userId&&(e.demo1=t.userId),e},i([w()],_t.prototype,"serverInfo",void 0),i([w()],_t.prototype,"mediaInfo",void 0),_t);function _t(t){var e=Bt.call(this,t)||this;return e.agent=t,e}n.OzTamDao=jt},{}]},{},[1])(1)});